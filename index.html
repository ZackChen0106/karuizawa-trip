<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>2026 初春 · 輕井澤 · 東京</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link rel="stylesheet" href="style.css?v=hero-fixed" />
  <link rel="manifest" href="manifest.json" />
</head>

<body data-page="home">
<div class="app">

  <!-- Hero -->
  <div class="hero" id="hero" style="background-image:url('./hero.jpg')">
    <div class="heroContent">
      <h1 class="heroTitle">2026 初春 · 輕井澤 · 東京</h1>
      <p class="heroSub">旅遊的精髓在於懷著開放的心態欣賞一切</p>
      <div class="pillRow">
        <span class="pill" id="pillDay"></span>
        <span class="pill">🇯🇵 日本</span>
      </div>
    </div>
  </div>

  <!-- Pages -->
  <div class="pages">

    <!-- ================= Home ================= -->
    <section class="page active" data-page="home">
      <div class="main">

        <div class="card" id="todayCard" style="cursor:pointer">
          <div class="cardHeader">
            <h2 class="cardTitle">TODAY</h2>
            <span class="cardHint">點一下看今日行程</span>
          </div>
          <p class="bigText" id="todayMain"></p>
          <p class="subText" id="todayRoute"></p>
          <p class="subText" id="todayNote"></p>
        </div>

        <!-- 輕井澤天氣 -->
        <div class="card">
          <div class="cardHeader">
            <h2 class="cardTitle">輕井澤</h2>
            <span class="cardHint">2 月下旬典型天氣</span>
          </div>

          <div style="display:flex;align-items:flex-end;gap:12px;">
            <div style="font-size:36px;font-weight:800;">2～8°</div>
            <div class="subText">夜間 -5～0°</div>
          </div>

          <div class="subText" style="margin-top:10px;">
            🧣 穿搭／注意事項：<br>
            厚外套必備，建議圍巾、手套；清晨與夜晚路面可能結冰
          </div>

          <!-- Live Cam -->
          <a
            href="https://www.youtube.com/watch?v=iLfmRhMarWM"
            target="_blank"
            style="
              display:block;
              margin-top:14px;
              border-radius:12px;
              overflow:hidden;
              position:relative;
              text-decoration:none;
            "
          >
            <img
              src="https://img.youtube.com/vi/iLfmRhMarWM/hqdefault.jpg"
              alt="輕井澤 Live Cam"
              style="width:100%;display:block;"
            />
            <div style="
              position:absolute;
              inset:0;
              background:linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,.15));
              display:flex;
              align-items:flex-end;
              padding:10px;
              color:#fff;
              font-size:14px;
              font-weight:600;
            ">
              📹 即時影像（YouTube Live）
            </div>
          </a>
        </div>

        <!-- 東京天氣 -->
        <div class="card">
          <div class="cardHeader">
            <h2 class="cardTitle">東京</h2>
            <span class="cardHint">2 月下旬典型天氣</span>
          </div>

          <div style="display:flex;align-items:flex-end;gap:12px;">
            <div style="font-size:36px;font-weight:800;">8～15°</div>
            <div class="subText">夜間 3～7°</div>
          </div>

          <div class="subText" style="margin-top:10px;">
            👕 穿搭／注意事項：<br>
            洋蔥式穿搭即可，白天舒適、早晚稍涼
          </div>

          <!-- Live Cam -->
          <a
            href="https://www.youtube.com/watch?v=gCu45mPX77Y"
            target="_blank"
            style="
              display:block;
              margin-top:14px;
              border-radius:12px;
              overflow:hidden;
              position:relative;
              text-decoration:none;
            "
          >
            <img
              src="https://img.youtube.com/vi/gCu45mPX77Y/hqdefault.jpg"
              alt="東京 Live Cam"
              style="width:100%;display:block;"
            />
            <div style="
              position:absolute;
              inset:0;
              background:linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,.15));
              display:flex;
              align-items:flex-end;
              padding:10px;
              color:#fff;
              font-size:14px;
              font-weight:600;
            ">
              📹 即時影像（YouTube Live）
            </div>
          </a>
        </div>

      </div>
    </section>

    <!-- ================= Transport ================= -->
    <section class="page" data-page="transport">
      <div class="pageWrap">
        <h2 class="pageTitle">🚆 交通</h2>

        <!-- 子分頁 Tabs -->
        <div class="transportTabs">
          <button class="transportTab active" data-transport="flight">✈️ 機票</button>
          <button class="transportTab" data-transport="skyliner">🚆 Skyliner</button>
          <button class="transportTab" data-transport="shinkansen">🚄 北陸新幹線</button>
        </div>

        <!-- 機票（原 flight 內容搬進來） -->
        <div class="transportPanel" data-transport="flight">
          <div class="card">
            <h3 class="cardTitle">🛫 去程｜2026 / 02 / 21</h3>
            <p class="subText">酷航 TR898</p>
            <p class="subText">06:40 桃園機場 → 10:40 成田機場</p>
            <p class="subText">訂位代號：<strong>H78HXF</strong></p>
          </div>

          <div class="card">
            <h3 class="cardTitle">🛬 回程｜2026 / 02 / 25</h3>
            <p class="subText">虎航 IT203</p>
            <p class="subText">18:25 成田機場 → 21:50 桃園機場</p>
            <p class="subText">訂位代號：<strong>SEUY8R</strong></p>
          </div>

          <div class="card">
            <h3 class="cardTitle">🎒 行李規定</h3>
            <p class="subText">個人物品：40 × 30 × 10 cm（1 件）</p>
            <p class="subText">手提行李：10 kg｜54 × 38 × 23 cm（1 件）</p>
            <p class="subText">托運行李：25 kg｜尺寸總和 ≤ 158 cm</p>
          </div>

          <div class="card">
            <h3 class="cardTitle">👨‍👩‍👧‍👦 成員</h3>
            <p class="subText">CHEN JOUJOU｜351421829</p>
            <p class="subText">HUANG HSUEHWEN｜364399760</p>
            <p class="subText">WEI JIAWUN｜369037617</p>
            <p class="subText">CHEN KUOHSUAN｜351812837</p>
          </div>
        </div>

        <!-- Skyliner -->
        <div class="transportPanel" data-transport="skyliner" style="display:none;">

          <!-- ⚠️ 假日提醒（最上面） -->
          <div class="card" style="
            background: linear-gradient(
              135deg,
              rgba(255,180,60,.18),
              rgba(255,180,60,.08)
            );
            border-left:4px solid #ffb43c;
          ">
            <p style="
              margin:0;
              font-size:15px;
              font-weight:700;
              color:#ffd27d;
            ">
              ⚠️ 02/21–02/23 為日本國定假日
            </p>
            <p class="subText" style="margin-top:6px;">
              交通與機場人潮較多，請預留排隊與轉乘時間
            </p>
          </div>

          <!-- 🚆 官方資訊卡 -->
          <div class="card">
            <h3 class="cardTitle">🚆 京成 Skyliner 官方資訊</h3>

            <a
              href="https://www.keisei.co.jp/keisei/tetudou/skyliner/tc/traffic/skyliner.php"
              target="_blank"
              style="
                display:block;
                border-radius:14px;
                overflow:hidden;
                text-decoration:none;
                position:relative;
              "
            >
              <img
                src="skyliner.jpg"
                alt="Skyliner 官方交通資訊"
                style="width:100%;display:block;"
              />

              <div style="
                position:absolute;
                inset:0;
                background:linear-gradient(to top, rgba(0,0,0,.75), rgba(0,0,0,.15));
                display:flex;
                align-items:flex-end;
                padding:14px;
                color:#fff;
                font-size:15px;
                font-weight:700;
              ">
                🔗 查看 Skyliner 官方交通資訊
              </div>
            </a>

            <p class="subText" style="margin-top:10px;">
              點擊後將於新分頁開啟京成電鐵官方網站
            </p>
          </div>

        </div>

        <!-- 北陸新幹線 -->
        <div class="transportPanel" data-transport="shinkansen" style="display:none;">

          <!-- ⚠️ 提醒卡 -->
          <div class="card" style="
            background:linear-gradient(135deg,#3b2f1c,#1e1a14);
            border-left:4px solid #ffcc66;
          ">
            <div style="display:flex;gap:10px;align-items:flex-start;">
              <div style="font-size:22px;">⚠️</div>
              <div>
                <div style="font-weight:700;margin-bottom:4px;">
                  02/21–02/23 為日本國定假日
                </div>
                <div class="subText">
                  北陸新幹線為熱門路線，建議提早查詢班次並預留轉乘時間
                </div>
              </div>
            </div>
          </div>

          <!-- 🚄 官方查詢入口 -->
          <div class="card">
            <h3 class="cardTitle">🚄 北陸新幹線 班次查詢（Navitime）</h3>

            <a
              href="https://japantravel.navitime.com/zh-tw/area/jp/depArrTimeList/00004067/00002048/00000177?direction=down&date=2026-02-21&hour=13&trainType=&type="
              target="_blank"
              style="
                display:block;
                padding:18px;
                border-radius:14px;
                background:linear-gradient(135deg,#1f2a38,#0f1622);
                text-decoration:none;
                color:#fff;
                border:1px solid rgba(255,255,255,.15);
              "
            >
              <div style="font-size:16px;font-weight:700;margin-bottom:6px;">
                🔍 查詢 輕井澤 → 東京 班次
              </div>
              <div class="subText">
                開啟 Navitime 官方列車時刻與轉乘資訊
              </div>
            </a>

            <p class="subText" style="margin-top:10px;">
              點擊後將於新分頁開啟 Navitime 官方網站
            </p>
          </div>

        </div>

      </div>
    </section>

    <!-- ================= Itinerary ================= -->
    <section class="page" data-page="itinerary">
      <div class="pageWrap">
        <h2 class="pageTitle">🗺️ 行程</h2>

        <!-- Day Tabs（橫向切換） -->
        <div class="dayTabs" style="
          display:flex;
          gap:8px;
          overflow-x:auto;
          padding-bottom:8px;
          margin-bottom:8px;
          -webkit-overflow-scrolling:touch;
        ">
          <button class="pill" data-day="0">Day 1｜輕井澤</button>
          <button class="pill" data-day="1">Day 2｜輕井澤</button>
          <button class="pill" data-day="2">Day 3｜輕井澤 → 東京</button>
          <button class="pill" data-day="3">Day 4｜東京</button>
          <button class="pill" data-day="4">Day 5｜返程</button>
        </div>

        <!-- 行程內容容器 -->
        <div class="card">
          <div class="dayPanel" data-day="0"></div>
          <div class="dayPanel" data-day="1" style="display:none;"></div>
          <div class="dayPanel" data-day="2" style="display:none;"></div>
          <div class="dayPanel" data-day="3" style="display:none;"></div>
          <div class="dayPanel" data-day="4" style="display:none;"></div>
        </div>

      </div>
    </section>

    <!-- ================= Hotel ================= -->
    <section class="page" data-page="hotel">
      <div class="pageWrap">
        <h2 class="pageTitle">🏡 住宿</h2>

        <!-- 輕井澤 -->
        <div class="card" style="padding:0;overflow:hidden;background:#000;">
          <div style="
            position:relative;
            height:320px;
            background-image:url('./karuhotel.jpg');
            background-size:cover;
            background-position:center;
          ">
            <div style="
              position:absolute;
              inset:0;
              background:linear-gradient(
                to top,
                rgba(0,0,0,0.85),
                rgba(0,0,0,0.45),
                rgba(0,0,0,0.15)
              );
            "></div>

            <div style="
              position:absolute;
              inset:0;
              padding:20px;
              display:flex;
              flex-direction:column;
              justify-content:flex-end;
              color:#fff;
            ">
              <h3 style="margin:0 0 6px 0;font-size:22px;">🌲 輕井澤渴望之家飯店</h3>

              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
                <span class="pill">02/21 – 02/23</span>
                <span class="pill">Karuizawa · Nagano</span>
              </div>

              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <a class="pill pill-nav" href="https://maps.app.goo.gl/..." target="_blank">
                  🧭 導航
                </a>

                <span class="pill">🛏 兩間雙人房</span>
                <span class="pill">☎️ +81 267-42-7355</span>
              </div>
            </div>
          </div>
        </div>

        <!-- 東京 -->
        <div class="card" style="padding:0;overflow:hidden;background:#000;">
          <div style="
            position:relative;
            height:320px;
            background-image:url('./apretonhotel.jpg');
            background-size:cover;
            background-position:center;
          ">
            <div style="
              position:absolute;
              inset:0;
              background:linear-gradient(
                to top,
                rgba(0,0,0,0.85),
                rgba(0,0,0,0.45),
                rgba(0,0,0,0.15)
              );
            "></div>

            <div style="
              position:absolute;
              inset:0;
              padding:20px;
              display:flex;
              flex-direction:column;
              justify-content:flex-end;
              color:#fff;
            ">
              <h3 style="margin:0 0 6px 0;font-size:22px;">🏙️ Hotel Apreton（上野）</h3>

              <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px;">
                <span class="pill">02/23 – 02/25</span>
                <span class="pill">Tokyo · Ueno</span>
              </div>

              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <a class="pill pill-nav"
                   href="https://maps.app.goo.gl/7sCP1PBgiBzV9PGv8"
                   target="_blank">
                  🧭 導航
                </a>

                <span class="pill">🛏 兩間雙人房</span>
                <span class="pill">☎️ +81 3-6284-2703</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </section>

    <!-- ================= Packing ================= -->
    <section class="page" data-page="packing">
      <div class="pageWrap">
        <h2 class="pageTitle">🎒 行李清單</h2>

        <div class="card">
          <h3 class="cardTitle">🧳 必備文件</h3>
          <label class="checkItem"><input type="checkbox" /><span>護照（有效期限 6 個月以上）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>機票 / 電子登機證</span></label>
          <label class="checkItem"><input type="checkbox" /><span>旅遊保險</span></label>
          <label class="checkItem"><input type="checkbox" /><span>信用卡 / 現金（日幣）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>身分證（備用）</span></label>
        </div>

        <div class="card">
          <h3 class="cardTitle">👕 衣物</h3>
          <label class="checkItem"><input type="checkbox" /><span>外套（防風 / 防寒）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>厚上衣（毛衣 / 刷毛）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>薄長袖（室內或疊穿）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>長褲 × 2–3</span></label>
          <label class="checkItem"><input type="checkbox" /><span>睡衣</span></label>
          <label class="checkItem"><input type="checkbox" /><span>內衣褲（天數＋1）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>襪子（厚襪建議）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>圍巾 / 保暖配件</span></label>
        </div>

        <div class="card">
          <h3 class="cardTitle">👟 鞋子 / 行走用品</h3>
          <label class="checkItem"><input type="checkbox" /><span>好走的鞋（最重要）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>備用鞋 / 室內拖鞋</span></label>
          <label class="checkItem"><input type="checkbox" /><span>鞋墊 / 足貼（走路多）</span></label>
        </div>

        <div class="card">
          <h3 class="cardTitle">🧴 盥洗 / 個人用品</h3>
          <label class="checkItem"><input type="checkbox" /><span>牙刷 / 牙膏</span></label>
          <label class="checkItem"><input type="checkbox" /><span>洗面乳 / 保養品</span></label>
          <label class="checkItem"><input type="checkbox" /><span>化妝品 / 卸妝用品</span></label>
          <label class="checkItem"><input type="checkbox" /><span>防曬（即使冬天）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>護唇膏（天氣很乾）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>乳液（天氣很乾）</span></label>
        </div>

        <div class="card">
          <h3 class="cardTitle">💊 健康 / 藥品</h3>
          <label class="checkItem"><input type="checkbox" /><span>個人常備藥</span></label>
          <label class="checkItem"><input type="checkbox" /><span>感冒藥 / 止痛藥</span></label>
          <label class="checkItem"><input type="checkbox" /><span>暈車藥</span></label>
          <label class="checkItem"><input type="checkbox" /><span>OK 繃 / 小藥包</span></label>
          <label class="checkItem"><input type="checkbox" /><span>暖暖包（輕井澤推薦）</span></label>
        </div>

        <div class="card">
          <h3 class="cardTitle">🔌 3C / 充電</h3>
          <label class="checkItem"><input type="checkbox" /><span>手機</span></label>
          <label class="checkItem"><input type="checkbox" /><span>行動電源</span></label>
          <label class="checkItem"><input type="checkbox" /><span>充電線</span></label>
          <label class="checkItem"><input type="checkbox" /><span>轉接頭（日本）</span></label>
          <label class="checkItem"><input type="checkbox" /><span>耳機</span></label>
          <label class="checkItem"><input type="checkbox" /><span>網卡</span></label>
        </div>

      </div>
    </section>

  </div>

  <!-- Tab Bar -->
  <nav class="tabbar">
    <a href="#home" data-tab="home" class="active">🏠 首頁</a>
    <a href="#transport" data-tab="transport">🚆 交通</a>
    <a href="#itinerary" data-tab="itinerary">🗺️ 行程</a>
    <a href="#hotel" data-tab="hotel">🏡 住宿</a>
    <a href="#packing" data-tab="packing">🎒 行李</a>
  </nav>

</div>

<script src="app.js?v=hero-fixed"></script>

<script>
/* ========= Day 1-5 資料 ========= */
const itineraryData = [
  {
    title: "Day 1｜抵達日｜台灣 → 日本 → 輕井澤",
    items: [
      {
        time: "06:40–10:40",
        title: "桃園機場 → 日本成田",
        details: { main: ["酷航 TR898"] }
      },
      {
        time: "11:30–12:30",
        title: "午餐",
        details: { main: ["機場找東西吃"] }
      },
      {
        time: "12:30",
        title: "出發輕井澤",
        details: { main: ["Skyliner + 北陸新幹線"] }
      },
      {
        time: "16:00–19:00",
        title: "輕井澤王子購物廣場",
        details: {
          main: ["逛街＋採買＋晚餐", "附近也可以逛逛看風景"]
        }
      },
      {
        time: "19:00",
        title: "飯店 Check in",
        details: {
          main: ["自由時間，可預約泡湯"],
          note: [
            "輕井澤站 → 飯店",
            "距離：約 2.4 km",
            "步行：約 30 分",
            "計程車：8–10 分｜¥900–1,200"
          ]
        }
      }
    ]
  },
  {
    title: "Day 2｜漫步輕井澤",
    items: [
      {
        time: "09:00–10:00",
        title: "雲場池",
        details: {
          main: [
            "飯店 → 雲場池",
            "距離：約 2.0 km",
            "步行：約 25 分",
            "計程車：6–8 分｜¥900–1,200"
          ],
          note: [
            "冬天湖面結冰、光線最好",
            "繞湖 20–30 分鐘剛好",
            "鞋底防滑",
            "不走木棧邊緣結冰處"
          ]
        }
      },
      {
        time: "10:15–13:00",
        title: "舊輕井澤銀座通",
        details: {
          main: [
            "雲場池 → 舊輕井澤銀座通",
            "距離：約 1.6 km",
            "步行：約 20 分（可行）",
            "計程車：5–7 分｜¥800–1,000"
          ],
          note: ["冬天不鑽小巷", "午餐在此解決"]
        }
      },
      {
        time: "13:15–16:00",
        title: "星野（榆樹街＋高原教會）",
        details: {
          main: [
            "舊輕井澤銀座通 → 星野",
            "距離：約 6.5 km",
            "公車：約 25–35 分（班距長）",
            "計程車：15 分｜¥2,500–3,000（最推薦）"
          ]
        }
      },
      {
        time: "13:30–14:30",
        title: "榆樹街小鎮",
        details: { main: ["溪流＋木屋雪景", "坐咖啡 20–30 分最舒服"] }
      },
      {
        time: "14:30–15:00",
        title: "輕井澤高原教會",
        details: { main: ["榆樹街步行過去（平緩）", "外觀拍照即可，15–20 分"] }
      },
      {
        time: "15:00–15:30",
        title: "溪畔短散步（視體力）",
        details: { main: ["只走平坦段", "不進深林"] }
      },
      {
        time: "15:30",
        title: "自由時間",
        details: {
          main: [
            "星野 → 飯店（計程車 15 分｜¥2,500–3,000）",
            "可以選擇回飯店或是去逛 Outlet"
          ]
        }
      }
    ]
  },
  {
    title: "Day 3｜出發東京",
    items: [
      {
        time: "10:01–11:06",
        title: "輕井澤 → 東京（上野）",
        details: {
          main: [
            "北陸新幹線",
            "抵達 JR 上野站",
            "票價：¥5,280"
          ],
          note: [
            "假日新幹線人多，提前到月台等候"
          ]
        }
      },
      {
        time: "11:30",
        title: "抵達飯店＋寄放行李",
        details: {
          main: [
            "飯店：Hotel Apreton（上野）",
            "先寄放行李，減輕負擔"
          ]
        }
      },
      {
        time: "11:30–14:00",
        title: "阿美橫町",
        details: {
          main: [
            "吃吃＋逛逛",
            "小吃、藥妝、伴手禮"
          ],
          note: [
            "中午人潮最多，注意隨身物品"
          ]
        }
      },
      {
        time: "14:00–16:00",
        title: "東京灣下午茶遊船體驗（交響樂號）",
        details: {
          main: [
            "從日出碼頭出發",
            "輕鬆海灣遊船，欣賞東京港景色"
          ],
          note: [
            "上野 → 濱松町（山手線）",
            "提早到碼頭報到"
          ]
        }
      },
      {
        time: "18:00–20:00",
        title: "秋葉原",
        details: {
          main: [
            "吃吃＋逛逛",
            "電器、動漫、特色商店"
          ],
          note: [
            "濱松町 → 秋葉原（山手線）"
          ]
        }
      }
    ]
  },
  {
    title: "Day 4｜東京一日遊",
    items: [
      {
        time: "10:00–13:00",
        title: "上野恩賜公園",
        details: {
          main: [
            "公園散步",
            "上野動物園（視時間與體力）",
            "不忍池"
          ],
          note: [
            "園區大，依體力調整動線"
          ]
        }
      },
      {
        time: "13:00–14:00",
        title: "午餐",
        details: {
          main: [
            "上野周邊用餐",
            "不需特別趕行程"
          ]
        }
      },
      {
        time: "15:00–15:30",
        title: "明治神宮",
        details: {
          main: [
            "參拜＋短時間散步",
            "感受都市中的森林神社"
          ],
          note: [
            "行程偏精華版，不久留"
          ]
        }
      },
      {
        time: "16:30–18:00",
        title: "澀谷 Shibuya Sky 展望台",
        details: {
          main: [
            "登高俯瞰東京市景",
            "日落與夜景視天氣狀況"
          ],
          note: [
            "需事先預約門票",
            "風大注意保暖"
          ]
        }
      }
    ]
  },
  {
    title: "Day 5｜Last Day",
    items: [
      {
        time: "10:00–13:00",
        title: "淺草寺",
        details: {
          main: [
            "雷門拍照",
            "仲見世商店街",
            "人力車體驗（視現場）"
          ],
          note: [
            "上午人潮較多"
          ]
        }
      },
      {
        time: "13:00–15:00",
        title: "午餐＋回飯店",
        details: {
          main: [
            "淺草或上野用餐",
            "回飯店取行李"
          ]
        }
      },
      {
        time: "15:20–16:03",
        title: "飯店 → 成田機場",
        details: {
          main: [
            "前往成田機場",
            "依實際班次搭乘"
          ],
          note: [
            "建議提早抵達機場"
          ]
        }
      },
      {
        time: "18:25–21:50",
        title: "回台灣囉",
        details: {
          main: [
            "虎航 IT203",
            "日本成田 → 桃園"
          ]
        }
      }
    ]
  }
];

/* ========= 小工具 ========= */
function escapeHTML(str) {
  return String(str ?? "")
    .replaceAll("&", "&amp;")
    .replaceAll("<", "&lt;")
    .replaceAll(">", "&gt;")
    .replaceAll('"', "&quot;")
    .replaceAll("'", "&#39;");
}

/* ========= Day render（含「時間軸線 + 節點」） ========= */
function renderDay(dayIndex) {
  const panel = document.querySelector(`.dayPanel[data-day="${dayIndex}"]`);
  if (!panel) return;

  const dayData = itineraryData[dayIndex];
  if (!dayData) return;

  let html = `<h3 class="cardTitle">${escapeHTML(dayData.title)}</h3>`;

  dayData.items.forEach((item, i) => {
    const id = `acc-${dayIndex}-${i}`;
    const isLast = i === dayData.items.length - 1;

    const mainHTML = item.details?.main
      ? item.details.main.map(t => `<p class="subText">${escapeHTML(t)}</p>`).join("")
      : "";

    const linkHTML = item.details?.link
      ? `<a href="${escapeHTML(item.details.link)}" target="_blank" class="pill pill-nav" style="margin-top:6px;display:inline-block;">🧭 導航</a>`
      : "";

    const noteHTML = item.details?.note
      ? item.details.note.map(n => `<p class="subText">⚠️ ${escapeHTML(n)}</p>`).join("")
      : "";

    const buyListHTML = item.details?.buyList
      ? `
        <div style="margin-top:8px;">
          <div class="subText">🛍 必買推薦</div>
          ${item.details.buyList.map(b => `<p class="subText">• ${escapeHTML(b)}</p>`).join("")}
        </div>
      `
      : "";

    // ====== 這段就是你要的「時間軸線 + 節點」：插在每個 itItem 裡（不用你另外找什麼 <div class="itItem"...> 現成的）======
    html += `
      <div class="itItem" style="
        position:relative;
        padding-left:36px;
        margin-bottom:22px;
      ">

        <!-- Timeline line（垂直線） -->
        <div style="
          position:absolute;
          left:16px;
          top:10px;
          width:2px;
          height:${isLast ? "calc(100% - 22px)" : "100%"};
          background:rgba(255,255,255,.12);
          border-radius:2px;
        "></div>

        <!-- Timeline node（節點） -->
        <div style="
          position:absolute;
          left:11px;
          top:16px;
          width:12px;
          height:12px;
          border-radius:50%;
          background:rgba(255,255,255,.85);
          box-shadow:
            0 0 0 3px rgba(255,255,255,.10),
            0 8px 18px rgba(0,0,0,.35);
        "></div>

        <!-- Accordion Header -->
        <div
          style="
            display:flex;
            gap:14px;
            cursor:pointer;
            padding:14px 16px;
            border-radius:14px;
            background:
              linear-gradient(
                180deg,
                rgba(255,255,255,.08),
                rgba(255,255,255,.02)
              );
            box-shadow:
              inset 0 0 0 1px rgba(255,255,255,.08),
              0 8px 24px rgba(0,0,0,.35);
          "
          onclick="
            const el = document.getElementById('${id}');
            const arrow = this.querySelector('.arrow');
            const open = el.style.display === 'block';
            el.style.display = open ? 'none' : 'block';
            arrow.textContent = open ? '▾' : '▴';
          "
        >

          <!-- 左側時間 -->
          <div style="
            min-width:78px;
            font-size:13px;
            font-weight:700;
            color:rgba(255,255,255,.55);
            letter-spacing:.3px;
            line-height:1.4;
          ">
            ${escapeHTML(item.time)}
          </div>

          <!-- 右側主標題 -->
          <div style="flex:1;">
            <div style="
              font-size:18px;
              font-weight:900;
              line-height:1.3;
              margin-bottom:4px;
            ">
              ${escapeHTML(item.title)}
            </div>
            <div style="
              font-size:12px;
              color:rgba(255,255,255,.45);
            ">
              點擊展開詳細資訊
            </div>
          </div>

          <!-- 箭頭 -->
          <div class="arrow" style="
            font-size:16px;
            opacity:.6;
            padding-top:2px;
          ">▾</div>

        </div>

        <!-- Accordion Body -->
        <div id="${id}" style="
          display:none;
          margin-top:10px;
          padding:12px;
          border-radius:12px;
          background: rgba(255,255,255,.04);
        ">
          ${mainHTML}
          ${linkHTML}
          ${noteHTML}
          ${buyListHTML}
        </div>

      </div>
    `;
  });

  panel.innerHTML = html;
}

/* ========= Itinerary Day Tabs ========= */
(function () {
  const itineraryPage = document.querySelector('.page[data-page="itinerary"]');
  if (!itineraryPage) return;

  const tabs = itineraryPage.querySelectorAll('.dayTabs .pill');
  const panels = itineraryPage.querySelectorAll('.dayPanel');

  function activateDay(dayIndex) {
    tabs.forEach(tab => {
      tab.classList.toggle('active', tab.dataset.day === String(dayIndex));
    });

    panels.forEach(p => {
      p.style.display = p.dataset.day === String(dayIndex) ? 'block' : 'none';
    });

    renderDay(Number(dayIndex));
  }

  tabs.forEach(tab => {
    tab.addEventListener('click', () => activateDay(tab.dataset.day));
  });

  // 初始顯示：如果外部有 getTodayDayIndex 就用，沒有就顯示 Day 1（index 0）
  const todayIndex = (typeof window.getTodayDayIndex === "function")
    ? Math.max(0, Number(window.getTodayDayIndex()) || 0)
    : 0;

  activateDay(todayIndex);
})();

/* 進入行程頁時，自動捲到目前 Day Tab */
const itineraryTab = document.querySelector('[data-tab="itinerary"]');
if (itineraryTab) {
  itineraryTab.addEventListener('click', () => {
    setTimeout(() => {
      const activeDay = document.querySelector('.page[data-page="itinerary"] .dayTabs .pill.active');
      if (activeDay) {
        activeDay.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
      }
    }, 120);
  });
}

/* ========= Transport 子分頁 ========= */
(function () {
  const page = document.querySelector('.page[data-page="transport"]');
  if (!page) return;

  const tabs = page.querySelectorAll('.transportTabs .transportTab');
  const panels = page.querySelectorAll('.transportPanel');

  tabs.forEach(tab => {
    tab.addEventListener('click', () => {
      const target = tab.dataset.transport;

      tabs.forEach(t => t.classList.remove('active'));
      tab.classList.add('active');

      panels.forEach(p => {
        p.style.display = p.dataset.transport === target ? 'block' : 'none';
      });
    });
  });
})();
</script>

</body>
</html>
